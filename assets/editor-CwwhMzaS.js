import{r as j,j as e,Q as I,c as T}from"./QuestionRenderer-CGTquOB1.js";const P=({config:t,selectedQuestion:n,onQuestionSelect:a,onPageAdd:r,onPageDelete:s,onQuestionAdd:d})=>{const[m,o]=j.useState(new Set([0])),[i,p]=j.useState(""),g=h=>{const l=new Set(m);l.has(h)?l.delete(h):l.add(h),o(l)},C=h=>h.required?"âœ“":h.show_when||h.conditional?"âš ":"â—‹",E=h=>i?h.filter(l=>l.id.toLowerCase().includes(i.toLowerCase())||l.question.toLowerCase().includes(i.toLowerCase())||l.type.toLowerCase().includes(i.toLowerCase())):h,c=h=>{const l={id:`question_${Date.now()}`,question:"New Question",type:"text_short",required:!1};d(h,l)};return t?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Search questions...",value:i,onChange:h=>p(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:t.pages.map((h,l)=>{const y=E(h.questions),w=m.has(l);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("button",{onClick:()=>g(l),className:"flex items-center gap-2 flex-1 text-left font-semibold text-gray-800 hover:text-blue-600",children:[e.jsx("span",{className:"text-xs",children:w?"â–¼":"â–¶"}),e.jsx("span",{children:"ðŸ“„"}),e.jsx("span",{children:h.title}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",h.questions.length,")"]})]}),t.pages.length>1&&e.jsx("button",{onClick:()=>{confirm(`Delete page "${h.title}"?`)&&s(l)},className:"text-red-600 hover:text-red-800 text-sm px-2",title:"Delete page",children:"âœ•"})]}),w&&e.jsxs("div",{className:"ml-6 space-y-1",children:[y.map(b=>e.jsx("button",{onClick:()=>a(b,l),className:`w-full text-left px-3 py-2 rounded text-sm transition-colors ${n?.id===b.id?"bg-blue-100 text-blue-900 border border-blue-300":"hover:bg-gray-100 text-gray-700"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xs mt-0.5",children:C(b)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:b.id}),e.jsx("div",{className:"text-xs text-gray-600 truncate",children:b.type})]})]})},b.id)),e.jsx("button",{onClick:()=>c(l),className:"w-full text-left px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded border border-dashed border-blue-300",children:"+ Add Question"})]})]},l)})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsx("button",{onClick:r,className:"w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"+ Add Page"})})]}):e.jsx("div",{className:"p-4",children:e.jsx("p",{className:"text-gray-500",children:"No configuration loaded"})})},S=["equals","not_equals","contains","not_contains","in","not_in","exists","not_exists","greater_than","less_than"],R=({conditional:t,config:n,onChange:a})=>{const[r,s]=j.useState(!!t),[d,m]=j.useState(!!t&&(!!t.and||!!t.or)),o=()=>{if(!n)return[];const l=[];return n.pages.forEach(y=>{y.questions.forEach(w=>{l.push(w.id)})}),l.sort()},i=()=>{r?(a(void 0),s(!1)):(a({question_id:"",operator:"equals",value:""}),s(!0))},p=(l,y)=>{t&&a({...t,[l]:y})},g=()=>{t&&(d?(a({question_id:"",operator:"equals",value:""}),m(!1)):(a({and:[{question_id:t.question_id||"",operator:t.operator||"equals",value:t.value||""},{question_id:"",operator:"equals",value:""}]}),m(!0)))},C=l=>{if(!t)return;const y=t[l]||[];a({...t,[l]:[...y,{question_id:"",operator:"equals",value:""}]})},E=(l,y)=>{if(!t)return;const b=(t[l]||[]).filter((f,_)=>_!==y);if(b.length===0){const{[l]:f,..._}=t;a(_)}else a({...t,[l]:b})},c=(l,y,w,b)=>{if(!t)return;const _=[...t[l]||[]];_[y]={..._[y],[w]:b},a({...t,[l]:_})},h=o();if(!r)return e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"This question is always shown (no conditions)"}),e.jsx("button",{type:"button",onClick:i,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add Condition"})]})});if(d){const l=t?.and?"and":"or",y=t?.[l]||[];return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Show when ",l.toUpperCase()," of these conditions are met:"]}),e.jsxs("button",{type:"button",onClick:()=>{if(!t)return;const w=y;a({[l==="and"?"or":"and"]:w})},className:"text-xs text-blue-600 hover:text-blue-800 underline",children:["Switch to ",l==="and"?"OR":"AND"]})]}),e.jsx("button",{type:"button",onClick:i,className:"text-xs text-red-600 hover:text-red-800",children:"Remove All"})]}),e.jsxs("div",{className:"space-y-3",children:[y.map((w,b)=>e.jsx("div",{className:"bg-white border border-gray-300 rounded-md p-3",children:e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Question ID"}),e.jsxs("select",{value:w.question_id||"",onChange:f=>c(l,b,"question_id",f.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),h.map(f=>e.jsx("option",{value:f,children:f},f))]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Operator"}),e.jsx("select",{value:w.operator||"equals",onChange:f=>c(l,b,"operator",f.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:S.map(f=>e.jsx("option",{value:f,children:f},f))})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Value"}),e.jsx("input",{type:"text",value:w.value||"",onChange:f=>c(l,b,"value",f.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Expected value..."})]}),e.jsx("div",{className:"col-span-1 flex items-end",children:e.jsx("button",{type:"button",onClick:()=>E(l,b),className:"text-red-600 hover:text-red-800 text-sm px-2 py-1",title:"Remove condition",children:"âœ•"})})]})},b)),e.jsx("button",{type:"button",onClick:()=>C(l),className:"w-full px-3 py-2 text-sm text-blue-600 bg-blue-50 border border-dashed border-blue-300 rounded hover:bg-blue-100",children:"+ Add Condition"})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("button",{type:"button",onClick:g,className:"text-xs text-gray-600 hover:text-gray-800 underline",children:"Switch to simple mode"})})]})}return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Show when:"}),e.jsx("button",{type:"button",onClick:i,className:"text-xs text-red-600 hover:text-red-800",children:"Remove Condition"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Question ID"}),e.jsxs("select",{value:t?.question_id||"",onChange:l=>p("question_id",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),h.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Operator"}),e.jsx("select",{value:t?.operator||"equals",onChange:l=>p("operator",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:S.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Value"}),e.jsx("input",{type:"text",value:t?.value||"",onChange:l=>p("value",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Expected value..."})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("button",{type:"button",onClick:g,className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"Add multiple conditions (AND/OR)"})})]})},$=({options:t,onChange:n})=>{const a=()=>{const o={value:`option_${t.length+1}`,label:"",description:""};n([...t,o])},r=o=>{const i=t.filter((p,g)=>g!==o);n(i)},s=(o,i,p)=>{const g=[...t];g[o]={...g[o],[i]:p},n(g)},d=o=>{if(o===0)return;const i=[...t];[i[o-1],i[o]]=[i[o],i[o-1]],n(i)},m=o=>{if(o===t.length-1)return;const i=[...t];[i[o],i[o+1]]=[i[o+1],i[o]],n(i)};return e.jsxs("div",{className:"space-y-3",children:[t.map((o,i)=>e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>d(i),disabled:i===0,className:`text-xs ${i===0?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:text-gray-900"}`,title:"Move up",children:"â–²"}),e.jsx("button",{type:"button",onClick:()=>m(i),disabled:i===t.length-1,className:`text-xs ${i===t.length-1?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:text-gray-900"}`,title:"Move down",children:"â–¼"})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Value"}),e.jsx("input",{type:"text",value:o.value,onChange:p=>s(i,"value",p.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., critical"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Label"}),e.jsx("input",{type:"text",value:o.label,onChange:p=>s(i,"label",p.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"e.g., Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Description (optional)"}),e.jsx("input",{type:"text",value:o.description||"",onChange:p=>s(i,"description",p.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Optional description..."})]})]}),e.jsx("button",{type:"button",onClick:()=>r(i),className:"text-red-600 hover:text-red-800 text-sm px-2 py-1",title:"Remove option",children:"âœ•"})]})},i)),e.jsx("button",{type:"button",onClick:a,className:"w-full px-3 py-2 text-sm text-blue-600 bg-blue-50 border border-dashed border-blue-300 rounded hover:bg-blue-100",children:"+ Add Option"}),t.length===0&&e.jsx("p",{className:"text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded p-3",children:"âš  This question type requires at least one option"})]})},A=["text_short","text_long","textarea","number","single_select","multi_select","boolean","datetime","datetime_range","cve","cve_input","internet_asset","file_upload","scale"],L=({question:t,config:n,onUpdate:a,onDelete:r})=>{const[s,d]=j.useState(null),[m,o]=j.useState(!1);if(j.useEffect(()=>{d(t?{...t}:null),o(!1)},[t]),!s)return e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg mb-2",children:"No question selected"}),e.jsx("p",{className:"text-sm",children:"Select a question from the browser or create a new one"})]})});const i=(c,h)=>{d({...s,[c]:h}),o(!0)},p=()=>{a(s),o(!1)},g=()=>{d(t?{...t}:null),o(!1)},C=()=>{const c={...s,id:`${s.id}_copy_${Date.now()}`};a(c)},E=s.type==="single_select"||s.type==="multi_select"||s.type==="scale";return e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Edit Question"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200",title:"Duplicate this question",children:"Duplicate"}),e.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this question?")&&r()},className:"px-3 py-1.5 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Delete"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Question ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.id,onChange:c=>i("id",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., incident_reference"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Unique identifier for this question (used in conditional logic)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Question Text ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:s.question,onChange:c=>i("question",c.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"What information are you collecting?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Question Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:s.type,onChange:c=>i("type",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:A.map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Determines how the question will be displayed to users"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"required",checked:s.required||!1,onChange:c=>i("required",c.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"required",className:"ml-2 text-sm font-medium text-gray-700",children:"Required field (users must answer this question)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Placeholder Text"}),e.jsx("input",{type:"text",value:s.placeholder||"",onChange:c=>i("placeholder",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Enter incident number..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hint text shown in the input field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Explanation / Help Text"}),e.jsx("textarea",{value:s.explanation||"",onChange:c=>i("explanation",c.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Provide additional context or instructions for this question..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Detailed help text shown below the question"})]}),E&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Options ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{options:s.options||[],onChange:c=>i("options",c)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conditional Logic"}),e.jsx(R,{conditional:s.show_when||s.conditional,config:n,onChange:c=>i("show_when",c)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This question will only be shown when the specified conditions are met"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:p,disabled:!m,className:`flex-1 px-4 py-2 rounded font-medium ${m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Save Changes"}),m&&e.jsx("button",{onClick:g,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"Cancel"})]})]})})},M=({question:t})=>{const[n,a]=j.useState("");return t?e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Live Preview"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This is how the question will appear to users"})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-base font-medium text-gray-900 mb-2",children:[t.question,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.explanation&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 leading-relaxed",children:t.explanation}),(t.show_when||t.conditional)&&e.jsx("div",{className:"mb-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:"âš  This question has conditional logic and may not always be visible"}),e.jsx(I,{question:t,value:n,onChange:a,showHint:!0})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("button",{onClick:()=>a(""),className:"text-xs text-gray-600 hover:text-gray-800 underline",children:"Reset Preview"})})]}),e.jsx("div",{className:"mt-6 space-y-3",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-3",children:"Question Details"}),e.jsxs("dl",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"ID:"}),e.jsx("dd",{className:"font-mono text-gray-900",children:t.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Type:"}),e.jsx("dd",{className:"font-mono text-gray-900",children:t.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Required:"}),e.jsx("dd",{className:"font-mono text-gray-900",children:t.required?"Yes":"No"})]}),t.options&&t.options.length>0&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600 mb-1",children:"Options:"}),e.jsx("dd",{className:"font-mono text-gray-900 ml-2",children:e.jsx("ul",{className:"list-disc list-inside",children:t.options.map((r,s)=>e.jsx("li",{children:r.label||r.value},s))})})]}),(t.show_when||t.conditional)&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-600 mb-1",children:"Conditional Logic:"}),e.jsx("dd",{className:"font-mono text-xs text-gray-900 bg-gray-100 p-2 rounded overflow-x-auto",children:e.jsx("pre",{children:JSON.stringify(t.show_when||t.conditional,null,2)})})]})]})]})})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"No question selected"}),e.jsx("p",{className:"text-xs mt-2",children:"Select a question to see how it will appear to users"})]})})},V=({errors:t,onQuestionClick:n})=>{const a=t.filter(s=>s.type==="error"),r=t.filter(s=>s.type==="warning");return t.length===0?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-green-600 text-xl",children:"âœ“"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800",children:"Configuration Valid"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"No errors or warnings found. Ready to download!"})]})]})}):e.jsxs("div",{className:"space-y-3",children:[a.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-red-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"âŒ"}),a.length," Error",a.length>1?"s":""," (Must Fix)"]}),e.jsx("div",{className:"space-y-2",children:a.map((s,d)=>e.jsx("div",{className:"bg-white border border-red-200 rounded p-3 text-sm",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[s.questionId&&e.jsxs("div",{className:"font-mono text-xs text-red-700 mb-1",children:[s.questionId,s.pageIndex!==void 0&&e.jsxs("span",{className:"text-red-500",children:[" (Page ",s.pageIndex+1,")"]})]}),e.jsx("p",{className:"text-red-900",children:s.message}),s.field&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Field: ",s.field]})]}),s.questionId&&s.pageIndex!==void 0&&n&&e.jsx("button",{onClick:()=>n(s.questionId,s.pageIndex),className:"text-xs text-red-600 hover:text-red-800 underline ml-3",children:"Jump to"})]})},d))})]}),r.length>0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-amber-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"âš "}),r.length," Warning",r.length>1?"s":""]}),e.jsx("div",{className:"space-y-2",children:r.map((s,d)=>e.jsx("div",{className:"bg-white border border-amber-200 rounded p-3 text-sm",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[s.questionId&&e.jsxs("div",{className:"font-mono text-xs text-amber-700 mb-1",children:[s.questionId,s.pageIndex!==void 0&&e.jsxs("span",{className:"text-amber-500",children:[" (Page ",s.pageIndex+1,")"]})]}),e.jsx("p",{className:"text-amber-900",children:s.message}),s.field&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Field: ",s.field]})]}),s.questionId&&s.pageIndex!==void 0&&n&&e.jsx("button",{onClick:()=>n(s.questionId,s.pageIndex),className:"text-xs text-amber-600 hover:text-amber-800 underline ml-3",children:"Jump to"})]})},d))}),e.jsx("p",{className:"text-xs text-amber-700 mt-3",children:"These are suggestions and won't prevent downloading, but may indicate potential issues."})]})]})},U=["text","text_short","text_long","textarea","number","single_select","multi_select","boolean","cve","cve_input","datetime","datetime_range","internet_asset","file_upload","scale"];class F{config;errors=[];questionIdMap=new Map;constructor(n){this.config=n,this.buildQuestionIdMap()}buildQuestionIdMap(){this.config.pages.forEach((n,a)=>{n.questions.forEach(r=>{this.questionIdMap.set(r.id,{pageIndex:a,question:r})})})}validate(){return this.errors=[],this.validateQuestionIds(),this.validateQuestionFields(),this.validateQuestionTypes(),this.validateOptions(),this.validateConditionalLogic(),this.validateCircularDependencies(),this.validateOrphanedQuestions(),this.errors}validateQuestionIds(){const n=new Map;this.config.pages.forEach((a,r)=>{a.questions.forEach(s=>{(!s.id||s.id.trim()==="")&&this.errors.push({type:"error",questionId:s.id,pageIndex:r,message:"Question ID cannot be empty",field:"id"});const d=n.get(s.id)||0;n.set(s.id,d+1)})}),n.forEach((a,r)=>{a>1&&this.errors.push({type:"error",questionId:r,message:`Duplicate question ID "${r}" found ${a} times`,field:"id"})})}validateQuestionFields(){this.config.pages.forEach((n,a)=>{n.questions.forEach(r=>{(!r.question||r.question.trim()==="")&&this.errors.push({type:"error",questionId:r.id,pageIndex:a,message:"Question text cannot be empty",field:"question"}),r.type||this.errors.push({type:"error",questionId:r.id,pageIndex:a,message:"Question type is required",field:"type"})})})}validateQuestionTypes(){this.config.pages.forEach((n,a)=>{n.questions.forEach(r=>{U.includes(r.type)||this.errors.push({type:"error",questionId:r.id,pageIndex:a,message:`Invalid question type "${r.type}"`,field:"type"})})})}validateOptions(){this.config.pages.forEach((n,a)=>{n.questions.forEach(r=>{["single_select","multi_select","scale"].includes(r.type)&&(!r.options||r.options.length===0?this.errors.push({type:"error",questionId:r.id,pageIndex:a,message:`Question type "${r.type}" requires at least one option`,field:"options"}):r.options.forEach((d,m)=>{(!d.value||d.value.trim()==="")&&this.errors.push({type:"error",questionId:r.id,pageIndex:a,message:`Option ${m+1} must have a value`,field:"options"}),(!d.label||d.label.trim()==="")&&this.errors.push({type:"warning",questionId:r.id,pageIndex:a,message:`Option ${m+1} is missing a label`,field:"options"})}))})})}validateConditionalLogic(){this.config.pages.forEach((n,a)=>{n.questions.forEach(r=>{const s=r.show_when||r.conditional;s&&this.validateConditional(s,r.id,a)})})}validateConditional(n,a,r){if(n.and)n.and.forEach(s=>{this.validateConditional(s,a,r)});else if(n.or)n.or.forEach(s=>{this.validateConditional(s,a,r)});else{const s=n.question_id||n.question;if(!s){this.errors.push({type:"error",questionId:a,pageIndex:r,message:"Conditional logic is missing question_id",field:"show_when"});return}this.questionIdMap.has(s)||this.errors.push({type:"error",questionId:a,pageIndex:r,message:`Referenced question "${s}" does not exist`,field:"show_when"}),s===a&&this.errors.push({type:"error",questionId:a,pageIndex:r,message:"Question cannot reference itself in conditional logic",field:"show_when"})}}validateCircularDependencies(){const n=new Set,a=new Set,r=(s,d)=>{if(a.has(s)){const o=d.indexOf(s),i=[...d.slice(o),s];return this.errors.push({type:"warning",questionId:s,message:`Circular dependency detected: ${i.join(" â†’ ")}`,field:"show_when"}),!0}if(n.has(s))return!1;n.add(s),a.add(s);const m=this.questionIdMap.get(s);if(m){const o=m.question.show_when||m.question.conditional;if(o){const i=this.extractDependencies(o);for(const p of i)if(r(p,[...d,s]))return!0}}return a.delete(s),!1};this.questionIdMap.forEach((s,d)=>{n.has(d)||r(d,[])})}extractDependencies(n){const a=[];if(n.and)n.and.forEach(r=>{a.push(...this.extractDependencies(r))});else if(n.or)n.or.forEach(r=>{a.push(...this.extractDependencies(r))});else{const r=n.question_id||n.question;r&&a.push(r)}return a}validateOrphanedQuestions(){this.config.pages.forEach((n,a)=>{n.questions.forEach(r=>{const s=r.show_when||r.conditional;s&&this.checkIfOrphaned(s,new Set)&&this.errors.push({type:"warning",questionId:r.id,pageIndex:a,message:"This question may be unreachable due to impossible conditions",field:"show_when"})})})}checkIfOrphaned(n,a){if(n.and)return n.and.some(m=>this.checkIfOrphaned(m,a));if(n.or)return n.or.every(m=>this.checkIfOrphaned(m,a));const r=n.question_id||n.question;if(!r||a.has(r))return!1;a.add(r);const s=this.questionIdMap.get(r);if(!s)return!0;const d=s.question.show_when||s.question.conditional;return d?this.checkIfOrphaned(d,a):!1}getBlockingErrors(){return this.errors.filter(n=>n.type==="error")}getWarnings(){return this.errors.filter(n=>n.type==="warning")}hasBlockingErrors(){return this.getBlockingErrors().length>0}}function Q(t){return new F(t).validate()}function q(t){return t.some(n=>n.type==="error")}const B=()=>{const[t,n]=j.useState(null),[a,r]=j.useState(null),[s,d]=j.useState(null),[m,o]=j.useState(!0),[i,p]=j.useState(null),[g,C]=j.useState([]),[E,c]=j.useState(!1);j.useEffect(()=>{(async()=>{try{const u=await fetch("/data/phase1-config.json");if(!u.ok)throw new Error("Failed to load configuration");const v=await u.json();n(v),o(!1)}catch(u){p(u instanceof Error?u.message:"Unknown error"),o(!1)}})()},[]),j.useEffect(()=>{if(t){const x=Q(t);C(x)}},[t]);const h=(x,u)=>{r(x),d(u)},l=x=>{if(!t||s===null)return;const u={...t},v=u.pages[s].questions,N=v.findIndex(k=>k.id===a?.id);N!==-1&&(v[N]=x,n(u),r(x))},y=(x,u)=>{if(!t)return;const v={...t};v.pages[x].questions.push(u),n(v),r(u),d(x)},w=()=>{if(!t||s===null||!a)return;const x={...t},u=x.pages[s].questions,v=u.findIndex(N=>N.id===a.id);v!==-1&&(u.splice(v,1),n(x),r(null))},b=()=>{if(!t)return;const x={id:`page_${Date.now()}`,title:`New Page ${t.pages.length+1}`,questions:[]},u={...t};u.pages.push(x),n(u)},f=x=>{if(!t)return;const u={...t};u.pages.splice(x,1),n(u),s===x&&(r(null),d(null))},_=()=>{if(!t)return;const x=Q(t);if(C(x),q(x)){c(!0),alert("Cannot export: Please fix all errors before downloading the configuration.");return}if(x.length>0&&!confirm(`There are ${x.length} warning(s) in your configuration. Do you want to continue with the download?`)){c(!0);return}const u=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),v=URL.createObjectURL(u),N=document.createElement("a");N.href=v,N.download="phase1-config.json",document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(v)},O=async x=>{try{const u=await x.text(),v=JSON.parse(u),N=Q(v);if(C(N),q(N)&&!confirm(`The imported configuration has ${N.filter(D=>D.type==="error").length} error(s). Import anyway?`)){c(!0);return}n(v),r(null),d(null),c(!0)}catch(u){alert("Failed to import configuration: "+(u instanceof Error?u.message:"Unknown error"))}};return m?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading configuration..."})]})}):i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-red-600 mb-4",children:["Error: ",i]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-full mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Question Editor"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Phase 1 Configuration"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(!E),className:`px-4 py-2 rounded border ${q(g)?"bg-red-50 text-red-700 border-red-300":g.length>0?"bg-amber-50 text-amber-700 border-amber-300":"bg-green-50 text-green-700 border-green-300"}`,children:q(g)?e.jsxs("span",{children:["âŒ ",g.filter(x=>x.type==="error").length," Errors"]}):g.length>0?e.jsxs("span",{children:["âš  ",g.length," Warnings"]}):e.jsx("span",{children:"âœ“ Valid"})}),e.jsxs("label",{className:"px-4 py-2 bg-white text-blue-600 border border-blue-600 rounded hover:bg-blue-50 cursor-pointer",children:["Import Config",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:x=>{const u=x.target.files?.[0];u&&O(u)}})]}),e.jsx("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Download Configuration"})]})]})})}),E&&e.jsx("div",{className:"bg-gray-100 border-b border-gray-200 p-4",children:e.jsx("div",{className:"max-w-full mx-auto",children:e.jsx(V,{errors:g,onQuestionClick:(x,u)=>{const N=t?.pages[u]?.questions.find(k=>k.id===x);N&&(h(N,u),c(!1))}})})}),e.jsxs("div",{className:"flex h-[calc(100vh-88px)]",children:[e.jsx("div",{className:"w-1/4 bg-white border-r border-gray-200 overflow-y-auto",children:e.jsx(P,{config:t,selectedQuestion:a,onQuestionSelect:h,onPageAdd:b,onPageDelete:f,onQuestionAdd:y})}),e.jsx("div",{className:"w-1/2 overflow-y-auto p-6",children:e.jsx(L,{question:a,config:t,onUpdate:l,onDelete:w})}),e.jsx("div",{className:"w-1/4 bg-white border-l border-gray-200 overflow-y-auto",children:e.jsx(M,{question:a})})]})]})};T.createRoot(document.getElementById("editor-root")).render(e.jsx(j.StrictMode,{children:e.jsx(B,{})}));
